<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PATINHO-BOARD ‚Äî Dashboard</title>
<style>
  :root {
    --bg:       #0d1117;
    --surface:  #161b22;
    --border:   #30363d;
    --accent:   #58a6ff;
    --green:    #3fb950;
    --yellow:   #d29922;
    --purple:   #bc8cff;
    --red:      #f85149;
    --text:     #e6edf3;
    --muted:    #8b949e;
    --radius:   10px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; min-height: 100vh; }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
  }
  .logo { display: flex; align-items: center; gap: .6rem; font-size: 1.15rem; font-weight: 700; color: var(--accent); text-decoration: none; }
  .logo span { font-size: 1.5rem; }
  nav a {
    color: var(--muted); text-decoration: none; margin-left: 1.5rem;
    font-size: .9rem; transition: color .2s;
  }
  nav a:hover, nav a.active { color: var(--text); }

  /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
  .page { max-width: 1100px; margin: 0 auto; padding: 2rem 1.5rem; }
  h1 { font-size: 1.4rem; margin-bottom: 1.5rem; }
  h2 { font-size: 1rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .06em; margin-bottom: 1rem; }

  /* ‚îÄ‚îÄ Stat cards ‚îÄ‚îÄ */
  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2.5rem; }
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 1.25rem 1.5rem;
  }
  .card .label { font-size: .78rem; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; }
  .card .value { font-size: 2rem; font-weight: 700; margin-top: .3rem; }
  .card.blue  .value { color: var(--accent); }
  .card.green .value { color: var(--green); }
  .card.purple .value { color: var(--purple); }

  /* ‚îÄ‚îÄ Se√ß√µes lado a lado ‚îÄ‚îÄ */
  .row { display: grid; grid-template-columns: 1fr 340px; gap: 1.5rem; }
  @media (max-width: 768px) { .row { grid-template-columns: 1fr; } }

  /* ‚îÄ‚îÄ Perguntas recentes ‚îÄ‚îÄ */
  .question-list { display: flex; flex-direction: column; gap: .75rem; }
  .q-item {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 1rem 1.25rem;
    cursor: pointer; transition: border-color .2s;
    text-decoration: none; color: inherit; display: block;
  }
  .q-item:hover { border-color: var(--accent); }
  .q-item .q-title { font-size: .95rem; font-weight: 600; margin-bottom: .4rem; }
  .q-meta { display: flex; align-items: center; gap: .75rem; font-size: .78rem; color: var(--muted); flex-wrap: wrap; }
  .badge {
    display: inline-block; padding: .15rem .55rem; border-radius: 20px;
    font-size: .72rem; font-weight: 600; border: 1px solid;
  }
  .badge-lang  { color: var(--accent);  border-color: var(--accent);  background: rgba(88,166,255,.1); }
  .badge-green { color: var(--green);   border-color: var(--green);   background: rgba(63,185,80,.1); }
  .badge-tag   { color: var(--muted);   border-color: var(--border);  background: transparent; }

  /* ‚îÄ‚îÄ Linguagens ‚îÄ‚îÄ */
  .lang-list { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
  .lang-item { display: flex; align-items: center; justify-content: space-between; padding: .75rem 1.25rem; border-bottom: 1px solid var(--border); }
  .lang-item:last-child { border-bottom: none; }
  .lang-name { font-size: .88rem; display: flex; align-items: center; gap: .5rem; }
  .lang-bar-wrap { flex: 1; margin: 0 1rem; height: 6px; background: var(--border); border-radius: 3px; }
  .lang-bar { height: 100%; border-radius: 3px; background: var(--accent); transition: width .4s; }
  .lang-count { font-size: .78rem; color: var(--muted); }

  /* ‚îÄ‚îÄ Bot√£o CTA ‚îÄ‚îÄ */
  .cta { text-align: center; margin-top: 2rem; }
  .btn {
    display: inline-flex; align-items: center; gap: .5rem;
    padding: .65rem 1.4rem; border-radius: var(--radius);
    font-size: .9rem; font-weight: 600; cursor: pointer; border: none;
    text-decoration: none; transition: opacity .2s;
  }
  .btn:hover { opacity: .85; }
  .btn-primary { background: var(--accent); color: #000; }

  /* ‚îÄ‚îÄ Skeleton ‚îÄ‚îÄ */
  .skeleton { background: var(--border); border-radius: 6px; animation: pulse 1.4s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
  .sk-line { height: 14px; margin-bottom: 8px; }

  /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
  .empty { text-align: center; padding: 2.5rem; color: var(--muted); font-size: .9rem; }
</style>
</head>
<body>

<header>
  <a class="logo" href="/"><span>ü¶Ü</span> PATINHO-BOARD</a>
  <nav>
    <a href="/" class="active">Dashboard</a>
    <a href="/board.html">Board</a>
  </nav>
</header>

<main class="page">
  <h1>Vis√£o Geral</h1>

  <!-- Cards de estat√≠sticas -->
  <div class="stats" id="stats">
    <div class="card blue">
      <div class="label">Perguntas</div>
      <div class="value" id="stat-q">‚Äî</div>
    </div>
    <div class="card purple">
      <div class="label">Respostas</div>
      <div class="value" id="stat-a">‚Äî</div>
    </div>
    <div class="card green">
      <div class="label">Respostas Aceitas</div>
      <div class="value" id="stat-acc">‚Äî</div>
    </div>
  </div>

  <div class="row">
    <!-- Perguntas recentes -->
    <section>
      <h2>√öltimas Perguntas</h2>
      <div class="question-list" id="recent-list">
        <!-- skeleton -->
        <div class="card" style="padding:1rem">
          <div class="skeleton sk-line" style="width:70%"></div>
          <div class="skeleton sk-line" style="width:40%"></div>
        </div>
        <div class="card" style="padding:1rem">
          <div class="skeleton sk-line" style="width:85%"></div>
          <div class="skeleton sk-line" style="width:45%"></div>
        </div>
        <div class="card" style="padding:1rem">
          <div class="skeleton sk-line" style="width:60%"></div>
          <div class="skeleton sk-line" style="width:35%"></div>
        </div>
      </div>
      <div class="cta">
        <a href="/board.html" class="btn btn-primary">Ver todas as perguntas ‚Üí</a>
      </div>
    </section>

    <!-- Linguagens -->
    <section>
      <h2>Linguagens</h2>
      <div class="lang-list" id="lang-list">
        <div class="lang-item"><div class="skeleton sk-line" style="width:100%;margin:0"></div></div>
        <div class="lang-item"><div class="skeleton sk-line" style="width:100%;margin:0"></div></div>
        <div class="lang-item"><div class="skeleton sk-line" style="width:100%;margin:0"></div></div>
      </div>
    </section>
  </div>
</main>

<script>
const API = '/api';

const LANG_ICONS = {
  javascript: 'üü®', typescript: 'üî∑', python: 'üêç',
  java: '‚òï', 'c++': '‚öôÔ∏è', 'c#': 'üíú', php: 'üêò',
  ruby: 'üíé', go: 'üêπ', rust: 'ü¶Ä', html: 'üåê', css: 'üé®',
};

async function loadStats() {
  try {
    const res  = await fetch(`${API}/stats`);
    const data = await res.json();
    document.getElementById('stat-q').textContent   = data.total_q;
    document.getElementById('stat-a').textContent   = data.total_a;
    document.getElementById('stat-acc').textContent = data.accepted;

    const total  = data.total_q || 1;
    const langs  = data.languages || [];
    const maxCnt = langs.reduce((m, l) => Math.max(m, l.count), 0) || 1;

    document.getElementById('lang-list').innerHTML = langs.length
      ? langs.map(l => `
          <div class="lang-item">
            <div class="lang-name">${LANG_ICONS[l.language] || 'üíª'} ${l.language}</div>
            <div class="lang-bar-wrap">
              <div class="lang-bar" style="width:${Math.round(l.count / maxCnt * 100)}%"></div>
            </div>
            <div class="lang-count">${l.count}</div>
          </div>
        `).join('')
      : '<div class="empty">Nenhuma pergunta ainda.</div>';
  } catch (e) {
    console.error(e);
  }
}

async function loadRecent() {
  try {
    const res  = await fetch(`${API}/questions`);
    const list = await res.json();
    const recent = list.slice(0, 5);
    const el = document.getElementById('recent-list');

    if (!recent.length) {
      el.innerHTML = '<div class="empty">Nenhuma pergunta ainda. <a href="/board.html">Seja o primeiro!</a></div>';
      return;
    }

    el.innerHTML = recent.map(q => {
      const tags = q.tags ? q.tags.split(',').map(t => t.trim()).filter(Boolean)
        .map(t => `<span class="badge badge-tag">${t}</span>`).join(' ') : '';
      const accepted = q.answer_count > 0 ? `<span class="badge badge-green">‚úî ${q.answer_count} resposta${q.answer_count > 1 ? 's' : ''}</span>` : `<span style="color:var(--muted);font-size:.78rem">sem respostas</span>`;
      return `
        <a class="q-item" href="/board.html#q${q.id}">
          <div class="q-title">${escHtml(q.title)}</div>
          <div class="q-meta">
            <span class="badge badge-lang">${q.language}</span>
            ${accepted}
            ${tags}
            <span>üëÅ ${q.views}</span>
            <span>por ${escHtml(q.author)}</span>
          </div>
        </a>`;
    }).join('');
  } catch (e) {
    console.error(e);
  }
}

function escHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

loadStats();
loadRecent();
</script>
</body>
</html>
